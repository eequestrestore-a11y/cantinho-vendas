<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Cantinho de Vendas</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-rose-50 p-8">

  <h1 class="text-3xl font-bold mb-6 text-rose-700">Meu Cantinho de Vendas</h1>

  <form id="saleForm" class="bg-white p-6 rounded-xl shadow-md space-y-4 mb-8">
    <input type="text" id="customerName" placeholder="Nome do Cliente" required class="w-full p-2 border rounded">
    <input type="number" id="salePrice" placeholder="Valor da Venda" required class="w-full p-2 border rounded">
    <button class="bg-rose-500 text-white px-4 py-2 rounded">Salvar Venda</button>
  </form>

  <div id="salesList" class="space-y-4"></div>

  <!-- FIREBASE -->
  <script type="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { 
      getFirestore, 
      collection, 
      addDoc, 
      deleteDoc, 
      doc,
      onSnapshot 
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDUGL9pDbOg2FNpYoqWZlwLv5mQgsGZyMg",
      authDomain: "haras-bcb32.firebaseapp.com",
      projectId: "haras-bcb32",
      storageBucket: "haras-bcb32.firebasestorage.app",
      messagingSenderId: "231821905690",
      appId: "1:231821905690:web:b16d076cdd8456e3b766a3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const vendasRef = collection(db, "vendas");

    const form = document.getElementById("saleForm");
    const salesList = document.getElementById("salesList");

    // SALVAR VENDA
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const customerName = document.getElementById("customerName").value;
      const salePrice = document.getElementById("salePrice").value;

      await addDoc(vendasRef, {
        customerName,
        salePrice,
        createdAt: new Date()
      });

      form.reset();
    });

    // LISTAR EM TEMPO REAL
    onSnapshot(vendasRef, (snapshot) => {
      salesList.innerHTML = "";

      snapshot.forEach((docSnap) => {
        const venda = docSnap.data();
        const id = docSnap.id;

        salesList.innerHTML += `
          <div class="bg-white p-4 rounded shadow flex justify-between items-center">
            <div>
              <p class="font-bold">${venda.customerName}</p>
              <p class="text-sm text-gray-500">R$ ${venda.salePrice}</p>
            </div>
            <button 
              onclick="deleteVenda('${id}')" 
              class="bg-red-500 text-white px-3 py-1 rounded">
              Excluir
            </button>
          </div>
        `;
      });
    });

    // DELETAR
    window.deleteVenda = async (id) => {
      await deleteDoc(doc(db, "vendas", id));
    };

  </script>

</body>
</html>
